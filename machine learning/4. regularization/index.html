
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.8">
    
    
      
        <title>四. 正则化 - 大白的知识库</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.644de097.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="大白的知识库" class="md-header__button md-logo" aria-label="大白的知识库" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            大白的知识库
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              四. 正则化
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      首页
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        机器学习
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../math%20in%20ML/" class="md-tabs__link">
        机器学习补充
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../recommender%20systems%20foundation/" class="md-tabs__link">
        推荐系统基础
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="大白的知识库" class="md-nav__button md-logo" aria-label="大白的知识库" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    大白的知识库
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        首页
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          机器学习
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="机器学习" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          机器学习
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        前言和目录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1.%20linear%20regression-1%20v/" class="md-nav__link">
        一. 单变量线性回归
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2.%20linear%20regression-m%20v/" class="md-nav__link">
        二. 多变量线性回归
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3.%20logistic%20regression/" class="md-nav__link">
        三. 逻辑回归
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          四. 正则化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        四. 正则化
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1、过拟合问题
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2、代价函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3、线性回归正则化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4、逻辑回归正则化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    习题 &amp;&amp; 参考答案
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    代码练习
  </a>
  
    <nav class="md-nav" aria-label="代码练习">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1visualizing-the-dataset" class="md-nav__link">
    1、Visualizing the dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2feature-mapping" class="md-nav__link">
    2、Feature mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3cost-function-and-gradient" class="md-nav__link">
    3、Cost function and gradient
  </a>
  
    <nav class="md-nav" aria-label="3、Cost function and gradient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-learning-parameter-using-fminunc" class="md-nav__link">
    3.1 Learning parameter using fminunc
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4plotting-the-decision-boundary" class="md-nav__link">
    4、Plotting the decision boundary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5optional-exercises" class="md-nav__link">
    5、Optional exercises
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../5.%20Neural%20Networks-R/" class="md-nav__link">
        五. 神经网络-表达
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../6.%20Neural%20Networks-L/" class="md-nav__link">
        六. 神经网络-学习
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          机器学习补充
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="机器学习补充" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          机器学习补充
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../math%20in%20ML/" class="md-nav__link">
        前言和目录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../math%20in%20ML/1.%20M%20derivation%20essence/" class="md-nav__link">
        一. 矩阵求导本质
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../math%20in%20ML/2.%20M%20derivation/" class="md-nav__link">
        二. 矩阵求导
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../math%20in%20ML/3.%20BP%20algorithm%20derivation/" class="md-nav__link">
        三. 神经网络BP算法原理和推导
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          推荐系统基础
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="推荐系统基础" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          推荐系统基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../recommender%20systems%20foundation/" class="md-nav__link">
        前言和目录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../recommender%20systems%20foundation/1.%20introduction/" class="md-nav__link">
        简介
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1、过拟合问题
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2、代价函数
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3、线性回归正则化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4、逻辑回归正则化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    习题 &amp;&amp; 参考答案
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    代码练习
  </a>
  
    <nav class="md-nav" aria-label="代码练习">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1visualizing-the-dataset" class="md-nav__link">
    1、Visualizing the dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2feature-mapping" class="md-nav__link">
    2、Feature mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3cost-function-and-gradient" class="md-nav__link">
    3、Cost function and gradient
  </a>
  
    <nav class="md-nav" aria-label="3、Cost function and gradient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-learning-parameter-using-fminunc" class="md-nav__link">
    3.1 Learning parameter using fminunc
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4plotting-the-decision-boundary" class="md-nav__link">
    4、Plotting the decision boundary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5optional-exercises" class="md-nav__link">
    5、Optional exercises
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>四. 正则化</h1>

<div class="admonition info">
<p>参考链接:
https://scruel.gitee.io/ml-andrewng-notes/week3.html</p>
</div>
<!--
下面这个css用于控制p标签的两端对齐
-->
<style type="text/css">
p {
    text-align: justify;  /*文本两端对齐*/
}
center img{
    border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);
}
center div{
    color:orange; 
    border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;
}
</style>

<h2 id="1">1、过拟合问题</h2>
<div class="admonition info">
<p>参考视频:
7 - 1 - The Problem of Overfitting (10 min).mkv</p>
</div>
<p>对于拟合的表现，可以分为三类情况：</p>
<ul>
<li>
<p>欠拟合(Underfitting)</p>
<p>无法很好的拟合训练集中的数据，预测值和实际值的误差很大，这类情况被称为欠拟合。拟合模型比较简单（特征选少了）时易出现这类情况。类似于，你上课不好好听，啥都不会，下课也差不多啥都不会。</p>
</li>
<li>
<p>优良的拟合(Just right)</p>
<p>不论是训练集数据还是不在训练集中的预测数据，都能给出较为正确的结果。类似于，学霸学神！</p>
</li>
<li>
<p>过拟合(Overfitting)</p>
<p>能很好甚至完美拟合训练集中的数据，即 <span class="arithmatex">\(J(\theta)\)</span>
，但是对于不在训练集中的<strong>新数据</strong>，预测值和实际值的误差会很大，<strong>泛化能力弱</strong>，这类情况被称为过拟合。拟合模型过于复杂（特征选多了）时易出现这类情况。类似于，你上课跟着老师做题都会都听懂了，下课遇到新题就懵了不会拓展。</p>
</li>
</ul>
<p>线性模型中的拟合情况(左图欠拟合，右图过拟合):</p>
<p><center>
    <img src="../../assets/images/4_1_1.png">
    <br>
    <div>图4.1.1 线性回归中的拟合情况</div>
</center></p>
<p>逻辑回归模型中的拟合情况:</p>
<p><center>
    <img src="../../assets/images/4_1_2.png">
    <br>
    <div>图4.1.2 逻辑回归中的拟合情况</div>
</center></p>
<p>为了度量拟合表现，引入：</p>
<ul>
<li>
<p>偏差(bias)</p>
<p>指模型的预测值与真实值的<strong>偏离程度</strong>。偏差越大，预测值偏离真实值越厉害。偏差低意味着能较好地反应训练集中的数据情况。</p>
</li>
<li>
<p>方差(Variance)</p>
<p>指模型预测值的<strong>离散程度或者变化范围</strong>。方差越大，数据的分布越分散，函数波动越大，泛化能力越差。方差低意味着拟合曲线的稳定性高，波动小。</p>
</li>
</ul>
<p>高偏差意味着欠拟合，高方差意味着过拟合。</p>
<p>我们应尽量使得拟合模型处于低方差（较好地拟合数据）状态且同时处于低偏差（较好地预测新值）的状态。</p>
<p>避免过拟合的方法有：</p>
<ul>
<li>
<p>减少特征的数量</p>
<ul>
<li>
<p>手动选取需保留的特征</p>
</li>
<li>
<p>使用模型选择算法来选取合适的特征(如 PCA 算法)</p>
</li>
<li>
<p>减少特征的方式易丢失有用的特征信息</p>
</li>
</ul>
</li>
<li>
<p>正则化(Regularization)</p>
<ul>
<li>
<p>可保留所有参数（许多有用的特征都能轻微影响结果）</p>
</li>
<li>
<p>减少/惩罚各参数大小(magnitude)，以减轻各参数对模型的影响程度</p>
</li>
<li>
<p>当有很多参数对于模型只有轻微影响时，正则化方法的表现很好</p>
</li>
</ul>
</li>
</ul>
<h2 id="2">2、代价函数</h2>
<div class="admonition info">
<p>参考视频:
7 - 2 - Cost Function (10 min).mkv</p>
</div>
<p>很多时候由于特征数量过多, 过拟合时我们很难选出要保留的特征, 这时候应用正则化方法则是很好的选择。</p>
<p>上文中, <span class="arithmatex">\(\theta_0+\theta_1x+\theta_2x^2+\theta_3x^3+\theta_4x^4\)</span> 这样一个复杂的多项式比较容易过拟合, 在不减少特征的情况下, <strong>如果能消除类似于</strong> <span class="arithmatex">\(\theta_3x^3, \theta_4x^4\)</span> <strong>等复杂部分, 那复杂函数就变得简单了。</strong></p>
<p>为了保留各个参数的信息, 不修改假设函数, 改而修改代价函数:</p>
<div class="arithmatex">\[
\min_{\theta}\frac{1}{2m}\sum_{i=1}^m{\big( h_\theta(x^{(i)})-y^{(i)} \big)^2+1000\cdot \theta_3^2+1000\cdot \theta_4^2}
\]</div>
<p>上式中, 我们在代价函数中增加了 <span class="arithmatex">\(\theta_3, \theta_4\)</span> 的惩罚项(penalty term) <span class="arithmatex">\(1000\cdot \theta_3^2+1000\cdot \theta_4^2\)</span> , 如果要最小化代价函数, 那么势必需要极大地减小 <span class="arithmatex">\(\theta_3, \theta_4\)</span> , 从而使得假设函数中的 <span class="arithmatex">\(\theta_3x^3, \theta_4x^4\)</span> 这两项的参数非常小, 就相当于没有了, 假设函数也就"变得"简单了, 从而在保留各参数的情况下避免了过拟合问题。</p>
<p><center>
    <img src="../../assets/images/4_2_1.png">
    <br>
    <div>图4.2.1 正则化后的拟合情况</div>
</center></p>
<p>根据上面的讨论，有时也无法决定要减少哪个参数，故统一惩罚除了 <span class="arithmatex">\(\theta_0\)</span> 外的所有参数。(不惩罚 <span class="arithmatex">\(\theta_0\)</span> 是约定俗成的, 实际上惩罚和不惩罚的结果差不多)</p>
<p>代价函数：</p>
<div class="arithmatex">\[
J(\theta)=\frac{1}{2m}\bigg[\sum_{i=1}^m{\big( h_\theta(x^{(i)})-y^{(i)} \big)^2+\lambda \sum_{j=1}^n \theta_j^2}\bigg]
\]</div>
<blockquote>
<p><span class="arithmatex">\(\lambda\)</span>  正则化参数(Regularization Parameter), <span class="arithmatex">\(\lambda&gt;0\)</span></p>
<p><span class="arithmatex">\(\sum_{j=1}^n\)</span> : 不惩罚基础参数 <span class="arithmatex">\(\theta_0\)</span></p>
<p><span class="arithmatex">\(\lambda \sum_{j=1}^n \theta_j^2\)</span> : 正则化项</p>
</blockquote>
<p><span class="arithmatex">\(\lambda\)</span> 正则化参数类似于学习速率，也需要我们自行对其选择一个合适的值。</p>
<ul>
<li>
<p>过大</p>
<ul>
<li>
<p>导致模型欠拟合(假设可能会变成近乎 <span class="arithmatex">\(x=\theta_0\)</span> 的直线 )</p>
</li>
<li>
<p>无法正常去过拟问题</p>
</li>
<li>梯度下降可能无法收敛</li>
</ul>
</li>
<li>
<p>过小</p>
<ul>
<li>无法避免过拟合（等于没有）</li>
</ul>
</li>
</ul>
<h2 id="3">3、线性回归正则化</h2>
<div class="admonition info">
<p>参考视频:
7 - 3 - Regularized Linear Regression (11 min).mkv</p>
</div>
<p>Regularized linear regression</p>
<div class="arithmatex">\[
J(\theta)=\frac{1}{2m}\bigg[\sum_{i=1}^m{\big( h_\theta(x^{(i)})-y^{(i)} \big)^2+\lambda \sum_{j=1}^n \theta_j^2}\bigg]
\]</div>
<p>Goal:</p>
<div class="arithmatex">\[\min_{\theta}J(\theta)\]</div>
<p>首先是使用梯度下降法完成这个目标:</p>
<p>Repeat  {</p>
<div class="arithmatex">\[
\theta_0:=\theta_0-\alpha \frac{1}{m} \sum_{i=1}^m \big(h_\theta(x^{(i)})-y^{(i)} \big) x_0^{(i)}
\]</div>
<div class="arithmatex">\[
\theta_j:=\theta_j-\alpha \bigg [\frac{1}{m} \sum_{i=1}^m \big(h_\theta(x^{(i)})-y^{(i)} \big) x_j^{(i)}+ \frac{\lambda}{m} \theta_j \bigg ]
\]</div>
<p>其中, <span class="arithmatex">\(j\in \{1,2,\cdots ,n\}\)</span></p>
<p>}</p>
<blockquote>
<p>这里更新 <span class="arithmatex">\(\theta_j\)</span> 相比于没正则化只多了一项 <span class="arithmatex">\(\frac{\lambda}{m}\theta_j\)</span>, 大家仔细研究会发现就是 <span class="arithmatex">\(J(\theta)\)</span> 中一个平方项求导产生, 因为比较简单, 所以这里就不做推导了。</p>
</blockquote>
<p>上式的第二项也可以移项得到更新表达式的另一种形式</p>
<div class="arithmatex">\[
\theta_j:=\theta_j(1- \alpha \frac{\lambda}{m})- \alpha \frac{1}{m} \sum_{i=1}^m \big(h_\theta(x^{(i)})-y^{(i)} \big) x_j^{(i)} 
\]</div>
<blockquote>
<p><span class="arithmatex">\(\frac{\lambda}{m} \theta_j\)</span> :正则化项</p>
</blockquote>
<p>应用正则化的正规方程法:</p>
<div class="arithmatex">\[
\theta = (X^TX+ \lambda \cdot L )^{-1}X^Ty
\]</div>
<p>其中, <span class="arithmatex">\(L=
\begin{bmatrix}
0 &amp;   &amp;  &amp;  &amp;   \\
  &amp; 1 &amp;   &amp;  &amp; \\
  &amp;   &amp; 1 &amp;   &amp;   \\
  &amp;   &amp;   &amp; \ddots &amp;  \\
  &amp;   &amp; &amp; &amp; 1 \\
\end{bmatrix}\)</span></p>
<blockquote>
<p><span class="arithmatex">\(\lambda \cdot L\)</span>: 正则化项</p>
<p><span class="arithmatex">\(L\)</span> : 第一行第一列为 0 的 <span class="arithmatex">\(n+1\)</span> 维单位矩阵</p>
</blockquote>
<p>前文提到正则化可以解决正规方程中不可逆问题, 即加入了 <span class="arithmatex">\(\lambda \cdot L\)</span> 正则化项后, 可以保证 <span class="arithmatex">\(X^TX+\lambda \cdot L\)</span> 可逆(invertible), 即便 <span class="arithmatex">\(X^TX\)</span> 不可逆(non-invertible)。</p>
<hr />
<p>下面对应用正则化的正规方程法结论进行推导</p>
<p>Cost Function</p>
<div class="arithmatex">\[
J(\theta)=\frac{1}{2m}\bigg[\sum_{i=1}^m{\big( h_\theta(x^{(i)})-y^{(i)} \big)^2+\lambda \sum_{j=1}^n \theta_j^2}\bigg]
\]</div>
<p>我们先假设连 <span class="arithmatex">\(\theta_0\)</span> 一起惩罚 并将上式向量化</p>
<div class="arithmatex">\[
J(\theta)=\frac{1}{2m}\bigg[(X\theta-\vec{y})^T(X\theta-\vec{y})+\lambda \theta^T \theta \bigg]
\]</div>
<p>然后开始求 <span class="arithmatex">\(J(\theta)\)</span> 关于 <span class="arithmatex">\(\theta\)</span> 的梯度, 即</p>
<div class="arithmatex">\[
\nabla _\theta J(\theta)=\nabla _\theta \frac{1}{2m}\bigg[(X\theta-\vec{y})^T(X\theta-\vec{y})+\lambda \theta^T \theta \bigg]
\]</div>
<p>由之前的结论</p>
<div class="arithmatex">\[
\nabla _\theta \frac{1}{2}(X\theta-\vec{y})^T(X\theta-\vec{y})= X^TX \theta-X^T \vec{y}
\]</div>
<p>所以我们现在只要关注后一项, 即</p>
<div class="arithmatex">\[
\nabla _\theta \frac{1}{2m} \cdot \lambda \theta^T \theta
\]</div>
<p>利用之前的结论</p>
<div class="arithmatex">\[ \nabla_A \operatorname{tr}(AB)=B^T\\\\ \]</div>
<div class="arithmatex">\[ \nabla_{A^T}f(A) = \big(\nabla_Af(A)\big)^T \\\\\]</div>
<div class="arithmatex">\[ \nabla_A \operatorname{tr}ABA^TC=CAB+C^TAB^T \\\\ \]</div>
<p>我们撇开系数, 先推导 <span class="arithmatex">\(\nabla_\theta \theta^T \theta\)</span> </p>
<div class="arithmatex">\[
\begin{aligned}
\nabla_\theta \theta^T \theta &amp;= (\nabla_{\theta^T}  \theta^T \theta)^T\\\\
&amp;= \big(\nabla_{\theta^T} \operatorname{tr}(\theta^T \theta) \big)^T\\\\
\end{aligned}
\]</div>
<p>然后, 可以令 <span class="arithmatex">\(\theta^T=A, B=C=I\)</span> 即</p>
<div class="arithmatex">\[
\begin{aligned}
\nabla_\theta \theta^T \theta &amp;=  \big(\nabla_{\theta^T} \operatorname{tr}(\theta^T \theta) \big)^T\\\\
&amp;= \big(\nabla_A \operatorname{tr}(ABA^TC)\big)^T\\\\
&amp;= \big(CAB+C^TAB^T\big)^T\\\\
&amp;= 2 A ^T \\\\
&amp;= 2 \theta
\end{aligned}
\]</div>
<p>所以</p>
<div class="arithmatex">\[
\nabla_\theta J(\theta)=\frac{1}{m}(X^TX \theta-X^T \vec{y}+\lambda \cdot \theta)
\]</div>
<p>为求 <span class="arithmatex">\(J(\theta)\)</span> 最小, 就是要令 <span class="arithmatex">\(\nabla_\theta J=0\)</span>, 所以</p>
<div class="arithmatex">\[
X^TX \theta-X^T \vec{y}+\lambda \cdot \theta=0
\]</div>
<p>解出 <span class="arithmatex">\(\theta\)</span> 为</p>
<div class="arithmatex">\[
\theta=(X^TX+\lambda \cdot E)^{-1}X^T \vec{y}
\]</div>
<p>其中, <span class="arithmatex">\(E\)</span> 为单位阵。</p>
<p>因为 <span class="arithmatex">\(\theta_0\)</span> 不参与正则, 我们仔细观察我们推导的结果与原来正规方程推导的结果, 就是多了一个 <span class="arithmatex">\(\lambda \cdot E\)</span> 这一项, 要让 <span class="arithmatex">\(\theta_0\)</span> 维持原来的结果, 我们只要让 <span class="arithmatex">\(E\)</span> 的第一行第一列为0, 这样和 <span class="arithmatex">\(\lambda\)</span> 相乘为0, 那么 <span class="arithmatex">\(\theta_0\)</span> 就会保持不变。</p>
<p>综上, 不惩罚 <span class="arithmatex">\(\theta_0\)</span> 的正规方程结论就是:</p>
<div class="arithmatex">\[
\theta = (X^TX+ \lambda \cdot L )^{-1}X^Ty
\]</div>
<p>其中, <span class="arithmatex">\(L=
\begin{bmatrix}
0 &amp;   &amp;  &amp;  &amp;   \\
  &amp; 1 &amp;   &amp;  &amp; \\
  &amp;   &amp; 1 &amp;   &amp;   \\
  &amp;   &amp;   &amp; \ddots &amp;  \\
  &amp;   &amp; &amp; &amp; 1 \\
\end{bmatrix}\)</span></p>
<h2 id="4">4、逻辑回归正则化</h2>
<div class="admonition info">
<p>参考视频:
7 - 4 - Regularized Logistic Regression (9 min).mkv</p>
</div>
<p>为逻辑回归的代价函数添加正则化项：</p>
<div class="arithmatex">\[
J(\theta)=-\frac{1}{m} \sum_{i=1}^m\Big[y^{(i)}\log \big(h_\theta(x^{(i)})\big)+ (1-y^{(i)})\log \big(1-h_\theta(x^{(i)})\big) \Big]+ \frac{\lambda}{2m}\sum_{j=1}^n \theta_j^2
\]</div>
<p>前文已经证明过逻辑回归和线性回归的代价函数的求导结果是一样的, 此处通过给正则化项添加常数 1/2, 则其求导结果也就一样了。</p>
<p>从而应用正则化的逻辑回归梯度下降算法:</p>
<p>Repeat {</p>
<div class="arithmatex">\[
\theta_0:=\theta_0-\alpha \frac{1}{m} \sum_{i=1}^m{(h_\theta(x^{(i)})-y^{(i)})x_0^{(i)}}
\]</div>
<div class="arithmatex">\[
\theta_j:=\theta_j-\alpha \bigg [\frac{1}{m} \sum_{i=1}^m \big(h_\theta(x^{(i)})-y^{(i)} \big) x_j^{(i)}+ \frac{\lambda}{m} \theta_j \bigg ]
\]</div>
<p>其中, <span class="arithmatex">\(j\in \{1,2,\cdots ,n\}\)</span></p>
<p>}</p>
<h2 id="_1">习题 &amp;&amp; 参考答案</h2>
<p><strong>第 1 题</strong></p>
<p>你正在训练一个分类逻辑回归模型。以下哪项陈述是正确的？选出所有正确项</p>
<p>A. 将正则化引入到模型中，总是能在训练集上获得相同或更好的性能</p>
<p>B. 在模型中添加许多新特性有助于防止训练集过度拟合</p>
<p>C. 将正则化引入到模型中，对于训练集中没有的例子，总是可以获得相同或更好的性能</p>
<p>D. 向模型中添加新特征总是会在训练集上获得相同或更好的性能</p>
<p><strong>第 2 题</strong></p>
<p>假设您进行了两次逻辑回归, 一次是 <span class="arithmatex">\(\lambda=0\)</span>, 一次是 <span class="arithmatex">\(\lambda=1\)</span>。其中一次, 得到参数 <span class="arithmatex">\(\theta=\begin{bmatrix} 81.47 \\  12.69  \\\end{bmatrix}\)</span> ,另一次, 得到 <span class="arithmatex">\(\theta=\begin{bmatrix} 13.01 \\  0.91  \\\end{bmatrix}\)</span> 。
但是，您忘记了哪个 <span class="arithmatex">\(\lambda\)</span> 值对应于哪个 <span class="arithmatex">\(\theta\)</span> 值。你认为哪个对应于 <span class="arithmatex">\(\lambda=1\)</span> ？</p>
<p>A. <span class="arithmatex">\(\theta=\begin{bmatrix} 13.01 \\  0.91  \\\end{bmatrix}\)</span></p>
<p>B. <span class="arithmatex">\(\theta=\begin{bmatrix} 81.47 \\  12.69  \\\end{bmatrix}\)</span></p>
<p><strong>第 3 题</strong></p>
<p>以下关于正则化的陈述哪一个是正确的？选出所有正确项</p>
<p>A. 使用太大的 <span class="arithmatex">\(\lambda\)</span> 值可能会导致您的假设与数据过拟合; 这可以通过减小 <span class="arithmatex">\(\lambda\)</span> 来避免</p>
<p>B. 使用非常大的 <span class="arithmatex">\(\lambda\)</span> 值不会影响假设的性能；我们不将 <span class="arithmatex">\(\lambda\)</span> 设置为太大的唯一原因是避免数值问题</p>
<p>C. 考虑一个分类问题。添加正则化可能会导致分类器错误地分类某些训练示例（当不使用正则化时, 即当 <span class="arithmatex">\(\lambda=0\)</span> 时，它正确地分类了这些示例）</p>
<p>D. 由于逻辑回归的输出值 <span class="arithmatex">\(0 \leq h_\theta(x) \leq 1\)</span> , 其输出值的范围无论如何只能通过正则化来“缩小”一点, 因此正则化通常对其没有帮助</p>
<p><strong>第 3 题</strong></p>
<p>下列哪一个图片的假设与训练集过拟合？</p>
<p>A.</p>
<p><center>
    <img src="../../assets/images/4_5_1A.jpg">
    <br>
    <div></div>
</center></p>
<p>B.</p>
<p><center>
    <img src="../../assets/images/4_5_1B.jpg">
    <br>
    <div></div>
</center></p>
<p>C.</p>
<p><center>
    <img src="../../assets/images/4_5_1C.jpg">
    <br>
    <div></div>
</center></p>
<p>D.</p>
<p><center>
    <img src="../../assets/images/4_5_1D.jpg">
    <br>
    <div></div>
</center></p>
<p><strong>第 5 题</strong></p>
<p>下列哪一个图片的假设与训练集欠拟合?</p>
<p>A.</p>
<p><center>
    <img src="../../assets/images/4_5_1D.jpg">
    <br>
    <div></div>
</center></p>
<p>B.</p>
<p><center>
    <img src="../../assets/images/4_5_2B.jpg">
    <br>
    <div></div>
</center></p>
<p>C.</p>
<p><center>
    <img src="../../assets/images/4_5_1B.jpg">
    <br>
    <div></div>
</center></p>
<p>D.</p>
<p><center>
    <img src="../../assets/images/4_5_1C.jpg">
    <br>
    <div></div>
</center></p>
<p><br/>
<br/>
<br/>
<br/>
<br/>
<br/></p>
<p><strong>参考答案</strong></p>
<p>第一题: D</p>
<p>第二题: A</p>
<p>第三题: C</p>
<p>第四题: A</p>
<p>第五题: A</p>
<h2 id="_2">代码练习</h2>
<p>In this part of exercise, you will implement regularized logistic regression to predict whether microchips from a fabrication plant passes quality assurance (QA). During QA, each microchips goes through various tests to ensure it is functioning correctly.</p>
<p>&ensp; Suppose you are the product manager of the factory and you have the test results for some microchips on two different tests. From these two tests, you would like to determine whether the microchips should be accepted or rejected. To help you make the decision, you have a dataset of test results on past microchips, from which you can build a logistic regression model.</p>
<h3 id="1visualizing-the-dataset">1、Visualizing the dataset</h3>
<p>Similar to the previous parts of this exercise, we need to plot a figure like Figure 4.6.1 , where the axes are the two test scores, and positive ( <span class="arithmatex">\(y=1\)</span>, accepted) and negative ( <span class="arithmatex">\(y=0\)</span>, rejected) examples are shown with different markers.</p>
<p>画图之前先瞅一眼数据</p>
<table class="highlighttable"><tr><th colspan="2" class="filename"><div class="highlight"><span class="filename">导入必要的库和数据</span></div></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># 导入必要的库</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="c1"># 导入数据</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c1"># path: 导入数据的路径</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;ex2data2.txt&quot;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="c1"># pandas.read_csv : pandas读入文本文件txt</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="c1"># path: 导入数据的路径 header=None : 源数据没有标题, names : 指定标题</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Test1&quot;</span><span class="p">,</span> <span class="s2">&quot;Test2&quot;</span><span class="p">,</span> <span class="s2">&quot;Accepted&quot;</span><span class="p">])</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="c1"># 显示数据的后五行</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p>输出</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>    Test1   Test2   Accepted
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>113     -0.720620   0.538740    0
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>114     -0.593890   0.494880    0
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>115     -0.484450   0.999270    0
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>116     -0.006336   0.999270    0
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>117     0.632650    -0.030612   0
</code></pre></div>
<p>画出图像</p>
<table class="highlighttable"><tr><th colspan="2" class="filename"><div class="highlight"><span class="filename">画图</span></div></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># 为了画图, 将数据分为Admitted = 0 和Admitted = 1 两部分</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">data1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Accepted&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="n">data0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Accepted&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="c1"># 用matplotlib画图</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="c1"># 1. 创建画布</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="c1"># 2. 绘制图像</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="c1"># 绘制训练集数据</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="c1"># 前两个参数 横纵坐标 s：标记大小 marker: 标记类型 color : 标记颜色</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data1</span><span class="p">[</span><span class="s2">&quot;Test1&quot;</span><span class="p">],</span> <span class="n">data1</span><span class="p">[</span><span class="s2">&quot;Test2&quot;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a>            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y = 1&quot;</span><span class="p">)</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data0</span><span class="p">[</span><span class="s2">&quot;Test1&quot;</span><span class="p">],</span> <span class="n">data0</span><span class="p">[</span><span class="s2">&quot;Test2&quot;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a>            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y = 0&quot;</span><span class="p">)</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="c1"># 2.1 添加描述信息</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Microchips Test1&quot;</span><span class="p">)</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Microchips Test2&quot;</span><span class="p">)</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="c1"># 2.2 添加网格显示</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="c1"># 2.3 添加图例</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="c1"># 2.4 显示图像</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p><center>
    <img src="../../assets/images/4_6_1.png">
    <br>
    <div>Fig 4.6.1 : Plot of training data</div>
</center></p>
<p>Figure 4.6.1 shows that our dataset cannot be separated into positive and negative examples by a straight-line through the plot. Therefore, a straight-foward application of logistic regression will not perform well on this dataset since logistic regression will only be able to find a linear decision boundary.</p>
<h3 id="2feature-mapping">2、Feature mapping</h3>
<p>One way to fit the data better is to create more features from each data point. We will map the features into all polynomial term of <span class="arithmatex">\(x_1\)</span> and <span class="arithmatex">\(x_2\)</span> up to the sixth power.</p>
<div class="arithmatex">\[
mapFeature(x)=\begin{bmatrix} 
1\\
x_1\\
x_2\\
x_1^2\\
x_1x_2\\
x_2^2\\
x_1^3\\
\vdots \\
x_1x_2^5\\
x_2^6
\\\end{bmatrix}
\]</div>
<p>&ensp; As a result of this mapping, our vector of two features (the scores on two QA tests) has been transformed into a 28-dimensional vector. A logistic regression classifier trained on this higher-dimension feature vector will have a more complex decision boundary and will appear nonlinear when drawn in our 2-dimension plot.</p>
<p>&ensp; While the feature mapping allows us to build a more expressive classifier, it also more susceptible to overfitting. In the next part of the exercise, you will implement regularized logistic regression to fit the data and also see for yourself how regularization can help combat the overfitting problem.</p>
<table class="highlighttable"><tr><th colspan="2" class="filename"><div class="highlight"><span class="filename">特征映射</span></div></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># 定义特征映射函数</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="k">def</span> <span class="nf">featureMapping</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span class="c1"># 定义一个字典</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="n">answer</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span class="c1"># 外层循环，映射的阶数</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>        <span class="c1"># 内存循环，x1的次数</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>            <span class="c1"># 形成字典中的key-value</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>            <span class="n">answer</span><span class="p">[</span><span class="s1">&#39;F</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="c1"># 转换为一个dataframe</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>    <span class="n">answer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>    <span class="c1"># 插入第一列全1</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>    <span class="n">answer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ones&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">answer</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a>    <span class="k">return</span> <span class="n">answer</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="c1"># 获取data列的数量</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="n">cols</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="c1"># 按照列的序号索引得到 X, y 并转成 ndarray</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">cols</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">cols</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="c1"># 瞅一眼X，y的维度是否正确</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="c1"># X.shape, y.shape</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="c1"># 开始特征映射 X</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="n">mappingX</span><span class="o">=</span><span class="n">featureMapping</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="mi">6</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<h3 id="3cost-function-and-gradient">3、Cost function and gradient</h3>
<p>Now you will implement code to compute the cost function and gradient for regularized logistic regression. Complete the code to return the cost and the gradient.</p>
<p>&ensp; Recall that the regularized cost function in logistic regression is</p>
<div class="arithmatex">\[
J(\theta)=-\frac{1}{m} \sum_{i=1}^m\Big[y^{(i)}\log \big(h_\theta(x^{(i)})\big)+ (1-y^{(i)})\log \big(1-h_\theta(x^{(i)})\big) \Big]+ \frac{\lambda}{2m}\sum_{j=1}^n \theta_j^2
\]</div>
<p>&ensp; Note that you should not regularize the parameter <span class="arithmatex">\(\theta_0\)</span>. The gradient of the cost function is a vector where the <span class="arithmatex">\(j^{th}\)</span> element is defined as follows:</p>
<p>for <span class="arithmatex">\(j=0\)</span> :</p>
<div class="arithmatex">\[
\frac{\partial J(\theta)}{\partial \theta_0}= \frac{1}{m} \sum_{i=1}^m{(h_\theta(x^{(i)})-y^{(i)})x_0^{(i)}}
\]</div>
<p>for <span class="arithmatex">\(j \geq 1\)</span> :</p>
<div class="arithmatex">\[
\frac{\partial J(\theta)}{\partial \theta_j}= \bigg (\frac{1}{m} \sum_{i=1}^m \big(h_\theta(x^{(i)})-y^{(i)} \big) x_j^{(i)}\bigg )+ \frac{\lambda}{m} \theta_j
\]</div>
<table class="highlighttable"><tr><th colspan="2" class="filename"><div class="highlight"><span class="filename">定义梯度计算函数以及cost函数, 并计算初始cost</span></div></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># 定义sigmoid函数</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z</span><span class="p">))</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="c1"># 定义梯度</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="k">def</span> <span class="nf">gradientReg</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lambdada</span><span class="p">):</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>    <span class="c1"># 生成一个和theta一样大小都是0的向量</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>    <span class="n">grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>        <span class="k">if</span><span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>            <span class="n">grad</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">X</span><span class="nd">@theta</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">))</span><span class="o">/</span><span class="n">m</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>        <span class="n">grad</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">@</span><span class="p">(</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">X</span><span class="nd">@theta</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">))</span><span class="o">/</span><span class="n">m</span><span class="p">)</span><span class="o">+</span><span class="n">lambdada</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">m</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>    <span class="k">return</span> <span class="n">grad</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="k">def</span> <span class="nf">costFunctionReg</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lambdada</span><span class="p">):</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>    <span class="c1"># 下面的A@B 相当于np.dot(A,B)</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>    <span class="n">first</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">X</span><span class="nd">@theta</span><span class="p">))</span><span class="nd">@y</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>    <span class="n">second</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">X</span><span class="nd">@theta</span><span class="p">))</span><span class="o">@</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>    <span class="c1"># 正则化项不惩罚x0, 所以这里将theta[0]=0, 让其不参与正则化计算</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>    <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>    <span class="n">reg</span> <span class="o">=</span> <span class="n">lambdada</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">T</span><span class="nd">@theta</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">first</span><span class="o">+</span><span class="n">second</span><span class="p">)</span><span class="o">/</span><span class="n">m</span><span class="o">+</span><span class="n">reg</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a><span class="c1"># 初始化theta</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="n">n</span> <span class="o">=</span> <span class="n">mappingX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="c1"># 初始化lambda</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a><span class="n">lambdada</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="c1"># 计算初始cost</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="n">costFunctionReg</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">mappingX</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lambdada</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>输出</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>0.6931471805599454
</code></pre></div>
<p>&ensp; Once you are done, you should see that the cost is about 0.693 by using the initial value of <span class="arithmatex">\(\theta\)</span> (initialized to all zeros).</p>
<p>可以看到我的输出结果为 <code>0.6931471805599454</code> 与吴恩达老师结果一致, 说明我的代价函数计算写得没问题。</p>
<h4 id="31-learning-parameter-using-fminunc">3.1 Learning parameter using fminunc</h4>
<p>Similar to be previous parts, you will use fminunc to learn the optimal parameters <span class="arithmatex">\(\theta\)</span>. If you have completed the cost and gradient for regularized logistic regression correctly, you should be able to step through the next part to learn the parameters <span class="arithmatex">\(\theta\)</span> using fminunc.</p>
<p>和上一个练习一样, 笔者是用python写的代码, 所以用不了吴恩达老师提到的 fminunc函数。依旧使用 <code>scipy.optimize</code> 中的 <code>minimize</code> 函数。</p>
<table class="highlighttable"><tr><th colspan="2" class="filename"><div class="highlight"><span class="filename">用scipy库的最小化方法计算出最佳theta</span></div></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">op</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="c1"># 初始化theta</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="n">n</span> <span class="o">=</span> <span class="n">mappingX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="c1"># 初始化lambda</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="n">lambdada</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="c1"># 利用minimize方法计算最佳theta</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="n">result</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="n">costFunctionReg</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">mappingX</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lambdada</span><span class="p">),</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>                     <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Newton-CG&#39;</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">gradientReg</span><span class="p">)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="c1"># theta_final接收函数计算出的最佳theta</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="n">theta_final</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="c1"># 显示最小化的结果</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="n">result</span>
</code></pre></div>
</td></tr></table>
<p>输出</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>    fun: 0.5296125764614318
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    jac: array([ 1.38401667e-04,  1.17628902e-04, -1.03817813e-04, -1.21318122e-05,
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    9.21842353e-05, -2.35445665e-05,  9.81995751e-05, -6.87897740e-05,
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    -4.73981188e-05,  1.66609202e-05,  3.28244899e-06, -5.54833116e-05,
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    -2.63705642e-05,  1.19848738e-05, -3.12746784e-05,  7.59400526e-05,
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    -5.32105636e-05, -4.18410567e-05, -2.82177412e-06, -1.94858732e-05,
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    -3.41982269e-05,  6.20073502e-06, -4.65078774e-05, -1.51522252e-05,
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    -3.32069805e-05, -7.24929349e-06, -2.04867140e-06, -7.28565483e-05])
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>message: &#39;Warning: Desired error not necessarily achieved due to precision loss.&#39;
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>nfev: 23
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>nhev: 0
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>nit: 3
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>njev: 39
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>status: 2
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>success: False
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>    x: array([ 1.14447434,  0.60265237,  1.16497505, -1.87495425, -0.90736979,
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    -1.27023904,  0.13068005, -0.37329   , -0.3522902 , -0.16801636,
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    -1.42502898, -0.05543182, -0.60846608, -0.26895465, -1.16389146,
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    -0.23899273, -0.21156258, -0.04877102, -0.27951764, -0.28976822,
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>    -0.4703471 , -1.03701361,  0.02382586, -0.29401771,  0.01330488,
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    -0.32911521, -0.13880385, -0.93769115])
</code></pre></div>
<p>关于 <code>minimize</code> 的 <code>method</code> 参数, 应该是最小化方法, 看文档有很多种 如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>- &#39;Nelder-Mead&#39; :ref:`(see here) &lt;optimize.minimize-neldermead&gt;`
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>- &#39;Powell&#39;      :ref:`(see here) &lt;optimize.minimize-powell&gt;`
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>- &#39;CG&#39;          :ref:`(see here) &lt;optimize.minimize-cg&gt;`
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>- &#39;BFGS&#39;        :ref:`(see here) &lt;optimize.minimize-bfgs&gt;`
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>- &#39;Newton-CG&#39;   :ref:`(see here) &lt;optimize.minimize-newtoncg&gt;`
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>- &#39;L-BFGS-B&#39;    :ref:`(see here) &lt;optimize.minimize-lbfgsb&gt;`
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>- &#39;TNC&#39;         :ref:`(see here) &lt;optimize.minimize-tnc&gt;`
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>- &#39;COBYLA&#39;      :ref:`(see here) &lt;optimize.minimize-cobyla&gt;`
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>- &#39;SLSQP&#39;       :ref:`(see here) &lt;optimize.minimize-slsqp&gt;`
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>- &#39;trust-constr&#39;:ref:`(see here) &lt;optimize.minimize-trustconstr&gt;`
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>- &#39;dogleg&#39;      :ref:`(see here) &lt;optimize.minimize-dogleg&gt;`
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>- &#39;trust-ncg&#39;   :ref:`(see here) &lt;optimize.minimize-trustncg&gt;`
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>- &#39;trust-exact&#39; :ref:`(see here) &lt;optimize.minimize-trustexact&gt;`
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>- &#39;trust-krylov&#39; :ref:`(see here) &lt;optimize.minimize-trustkrylov&gt;`
</code></pre></div>
<p>提前剧透, 笔者是都试了一下, 挑了决策边界图像显示和吴恩达老师最像的那个方法, 即 <code>Newton-CG</code> 。</p>
<p>关于这个最小化方法更多信息, 用使用 <code>np.info(op.minimize)</code> 可以查看函数的介绍。</p>
<h3 id="4plotting-the-decision-boundary">4、Plotting the decision boundary</h3>
<p>To help you visualize the model learned by this classifier, we plot the non-linear decision boundary by computing the classifier's predictions on an evenly spaced grid and then drew a contour plot of where the predictions change from <span class="arithmatex">\(y=0\)</span> and <span class="arithmatex">\(y=1\)</span>.</p>
<table class="highlighttable"><tr><th colspan="2" class="filename"><div class="highlight"><span class="filename">画决策边界</span></div></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span>
<span class="normal"><a href="#__codelineno-9-27">27</a></span>
<span class="normal"><a href="#__codelineno-9-28">28</a></span>
<span class="normal"><a href="#__codelineno-9-29">29</a></span>
<span class="normal"><a href="#__codelineno-9-30">30</a></span>
<span class="normal"><a href="#__codelineno-9-31">31</a></span>
<span class="normal"><a href="#__codelineno-9-32">32</a></span>
<span class="normal"><a href="#__codelineno-9-33">33</a></span>
<span class="normal"><a href="#__codelineno-9-34">34</a></span>
<span class="normal"><a href="#__codelineno-9-35">35</a></span>
<span class="normal"><a href="#__codelineno-9-36">36</a></span>
<span class="normal"><a href="#__codelineno-9-37">37</a></span>
<span class="normal"><a href="#__codelineno-9-38">38</a></span>
<span class="normal"><a href="#__codelineno-9-39">39</a></span>
<span class="normal"><a href="#__codelineno-9-40">40</a></span>
<span class="normal"><a href="#__codelineno-9-41">41</a></span>
<span class="normal"><a href="#__codelineno-9-42">42</a></span>
<span class="normal"><a href="#__codelineno-9-43">43</a></span>
<span class="normal"><a href="#__codelineno-9-44">44</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># 为了画图, 将数据分为Admitted = 0 和Admitted = 1 两部分</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">data1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Accepted&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="n">data0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Accepted&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="c1"># 用matplotlib画图</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="c1"># 1. 创建画布</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="c1"># 2. 绘制图像</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="c1"># 绘制训练集数据</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="c1"># 前两个参数 横纵坐标 s：标记大小 marker: 标记类型 color : 标记颜色</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data1</span><span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">],</span> <span class="n">data1</span><span class="p">[</span><span class="s2">&quot;x2&quot;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a>            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y = 1&quot;</span><span class="p">)</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data0</span><span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">],</span> <span class="n">data0</span><span class="p">[</span><span class="s2">&quot;x2&quot;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a>            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y = 0&quot;</span><span class="p">)</span>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="c1"># 2.1 添加描述信息</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Microchips Test1&quot;</span><span class="p">)</span>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Microchips Test2&quot;</span><span class="p">)</span>
<a id="__codelineno-9-20" name="__codelineno-9-20"></a>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="c1"># 2.2 添加网格显示</span>
<a id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-9-23" name="__codelineno-9-23"></a>
<a id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="c1"># 2.3 添加图例</span>
<a id="__codelineno-9-25" name="__codelineno-9-25"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-9-26" name="__codelineno-9-26"></a>
<a id="__codelineno-9-27" name="__codelineno-9-27"></a>
<a id="__codelineno-9-28" name="__codelineno-9-28"></a><span class="c1"># 通过绘制等高线图来绘制决策边界</span>
<a id="__codelineno-9-29" name="__codelineno-9-29"></a><span class="c1"># 创建一个从-1到1.5的等间距的数</span>
<a id="__codelineno-9-30" name="__codelineno-9-30"></a><span class="hll"><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
</span><a id="__codelineno-9-31" name="__codelineno-9-31"></a><span class="c1"># 形成一个250*250的网格，xx和yy分别对应x值和y值</span>
<a id="__codelineno-9-32" name="__codelineno-9-32"></a><span class="hll"><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><a id="__codelineno-9-33" name="__codelineno-9-33"></a><span class="c1"># 利用ravel()函数将xx和yy变成一个向量，也就是62500*1的向量</span>
<a id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="hll"><span class="n">answerMapping</span> <span class="o">=</span> <span class="n">featureMapping</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="mi">6</span><span class="p">)</span>  <span class="c1"># 进行特征映射</span>
</span><a id="__codelineno-9-35" name="__codelineno-9-35"></a><span class="c1"># 代入映射后的数据进行计算预测值</span>
<a id="__codelineno-9-36" name="__codelineno-9-36"></a><span class="hll"><span class="n">answer</span> <span class="o">=</span> <span class="n">answerMapping</span><span class="nd">@theta_final</span>
</span><a id="__codelineno-9-37" name="__codelineno-9-37"></a><span class="c1"># 将answer换成一样格式</span>
<a id="__codelineno-9-38" name="__codelineno-9-38"></a><span class="hll"><span class="n">answer</span> <span class="o">=</span> <span class="n">answer</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><a id="__codelineno-9-39" name="__codelineno-9-39"></a><span class="c1"># 绘制等高线图，0代表绘制第一条等高线</span>
<a id="__codelineno-9-40" name="__codelineno-9-40"></a><span class="hll"><span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;#97FF78&#39;</span><span class="p">)</span>
</span><a id="__codelineno-9-41" name="__codelineno-9-41"></a>
<a id="__codelineno-9-42" name="__codelineno-9-42"></a>
<a id="__codelineno-9-43" name="__codelineno-9-43"></a><span class="c1"># 2.4 显示图像</span>
<a id="__codelineno-9-44" name="__codelineno-9-44"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
<p>&ensp; After learning the parameters <span class="arithmatex">\(\theta\)</span>, we will plot a decision boundary similar to Figure 4.6.2.</p>
<h3 id="5optional-exercises">5、Optional exercises</h3>
<p>In this part of the exercise, you will get to try out different regularization parameters for the dataset to understand how regularization prevents overfitting.</p>
<p>&ensp; Notice the changes in the decision boundary as you vary <span class="arithmatex">\(\lambda\)</span>. With a small <span class="arithmatex">\(\lambda\)</span>, you should find that the classifier get almost every training example correct, but draws a very complicated boundary, thus overfitting the data (Figure 4.6.3). This is not a good decision boundary: For example, it predicts that a point at <span class="arithmatex">\(x=(-0.25,1.5)\)</span> is accepted <span class="arithmatex">\((y=1)\)</span>, which seems to be an incorrect decision given the training set.</p>
<p>&ensp; With a larger <span class="arithmatex">\(\lambda\)</span>, you should see a plot that shows an simple decision boundary which still separates the positives and negatives fairly well. However, if <span class="arithmatex">\(\lambda\)</span> is set to too high a value, you will not get a good fit and the decision boundary will not follow the data so well, thus underfitting the data (Figure 4.6.4).</p>
<p><center>
    <img src="../../assets/images/4_6_2.png">
    <br>
    <div>Figure 4.6.2 Training data with decision boundary (<span class="arithmatex">\(\lambda=1\)</span>) </div>
</center></p>
<p><center>
    <img src="../../assets/images/4_6_3.png">
    <br>
    <div>Figure 4.6.3 No regularization (Overfitting) (<span class="arithmatex">\(\lambda=0\)</span>) </div>
</center></p>
<p><center>
    <img src="../../assets/images/4_6_4.png">
    <br>
    <div>Figure 4.6.4 Too much regularization (Underfitting) (<span class="arithmatex">\(\lambda=100\)</span>) </div>
</center></p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            回到页面顶部
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="页脚">
      
        
        <a href="../3.%20logistic%20regression/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 三. 逻辑回归" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              三. 逻辑回归
            </div>
          </div>
        </a>
      
      
        
        <a href="../5.%20Neural%20Networks-R/" class="md-footer__link md-footer__link--next" aria-label="下一页: 五. 神经网络-表达" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              五. 神经网络-表达
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top"], "search": "../../assets/javascripts/workers/search.5e67fbfe.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c44cc438.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>